# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ mental.robotlida.by

## üìã –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è production

### ‚úÖ –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:

**–î–æ–º–µ–Ω:** `mental.robotlida.by`

### üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (CSRF –∏ COOKIE)

#### **–î–ª—è HTTP (–±–µ–∑ SSL):**
```python
CSRF_COOKIE_SECURE = False
SESSION_COOKIE_SECURE = False
```

#### **–î–ª—è HTTPS (—Å–æ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º):**
```python
CSRF_COOKIE_SECURE = True   # ‚úÖ TRUE
SESSION_COOKIE_SECURE = True   # ‚úÖ TRUE
```

## üìù –ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∫–∞–∂–¥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?

### `CSRF_COOKIE_SECURE` –∏ `SESSION_COOKIE_SECURE`:

| –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å | –ó–∞—á–µ–º |
|----------|-------------------|-------|
| **False** | HTTP –±–µ–∑ SSL | Cookie –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ –Ω–µ–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º—É HTTP |
| **True** | HTTPS —Å SSL | Cookie –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º—É HTTPS |

## üéØ –†–µ—à–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: **–ë–ï–ó SSL** (—Ç–æ–ª—å–∫–æ HTTP)

–í —Ñ–∞–π–ª–µ `.env` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
```env
CSRF_COOKIE_SECURE=False
SESSION_COOKIE_SECURE=False
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: **–° SSL** (—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º)

–í —Ñ–∞–π–ª–µ `.env` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
```env
CSRF_COOKIE_SECURE=True
SESSION_COOKIE_SECURE=True
```

## üîß –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

```bash
# 1. –ü–æ–¥—Ç—è–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main

# 2. –°–æ–∑–¥–∞–π—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª
cp env_production.txt .env

# 3. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ SSL, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env:
nano .env
# –ò–∑–º–µ–Ω–∏—Ç–µ:
# CSRF_COOKIE_SECURE=True
# SESSION_COOKIE_SECURE=True

# 4. –°–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏–∫—É
python manage.py collectstatic --noinput

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è CSRF
python fix_csrf_error.py

# 6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
touch tmp/restart.txt
```

## üìä –¢–∞–±–ª–∏—Ü–∞ —Ä–µ—à–µ–Ω–∏–π –ø—Ä–æ–±–ª–µ–º

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| 403 CSRF Error | –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CSRF_TRUSTED_ORIGINS | –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω –≤ CSRF_TRUSTED_ORIGINS |
| Admin –±–µ–∑ —Å—Ç–∏–ª–µ–π | –°—Ç–∞—Ç–∏–∫–∞ –Ω–µ —Å–æ–±—Ä–∞–Ω–∞ | –ó–∞–ø—É—Å—Ç–∏—Ç—å `collectstatic` |
| –ë–µ–ª–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 500 | –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `django.log` |
| Security Error | CSRF_COOKIE_SECURE=True –Ω–∞ HTTP | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ False |

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] –î–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ `ALLOWED_HOSTS`
- [ ] –î–æ–º–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω –≤ `CSRF_TRUSTED_ORIGINS`
- [ ] `DEBUG=False` –≤ .env
- [ ] –°—Ç–∞—Ç–∏–∫–∞ —Å–æ–±—Ä–∞–Ω–∞ (`collectstatic`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL (False –¥–ª—è HTTP, True –¥–ª—è HTTPS)
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫
- [ ] –¢–µ—Å—Ç –≤—Ö–æ–¥–∞ –≤ –∞–¥–º–∏–Ω–∫—É –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∫–∏:
```
http://mental.robotlida.by/admin/
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏–∫–∏:
```
http://mental.robotlida.by/static/admin/css/base.css
```
–î–æ–ª–∂–µ–Ω –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è CSS —Ñ–∞–π–ª.

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF:
```
http://mental.robotlida.by/debug/csrf/
```
–ü–æ–∫–∞–∂–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CSRF.

## üõ†Ô∏è Troubleshooting

### –û—à–∏–±–∫–∞: "DisallowedHost"
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ `ALLOWED_HOSTS`:
```python
ALLOWED_HOSTS = ['mental.robotlida.by']
```

### –û—à–∏–±–∫–∞: "CSRF verification failed"
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ `CSRF_TRUSTED_ORIGINS`:
```python
CSRF_TRUSTED_ORIGINS = ['http://mental.robotlida.by']
```

### –ê–¥–º–∏–Ω–∫–∞ –±–µ–∑ —Å—Ç–∏–ª–µ–π
**–†–µ—à–µ–Ω–∏–µ:** –°–æ–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏–∫—É:
```bash
python manage.py collectstatic --noinput
```

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞—é—Ç—Å—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `tail -f django.log`
- –õ–æ–≥–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞: `/var/log/apache2/error.log`
- –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

---

**–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ settings.py **–≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–µ—Ä–≤–µ—Ä**!
